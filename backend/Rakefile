require 'sinatra/activerecord/rake'
require 'dotenv/load'

# Load the application
require_relative 'app'

# Set the database file
set :database_file, 'config/database.yml'

# Define tasks
namespace :db do
  desc "Create the database"
  task :create do
    ActiveRecord::Base.establish_connection(ENV['DATABASE_URL'] || 'postgresql://localhost/listing_aggregator_development')
    ActiveRecord::Base.connection.create_database('listing_aggregator_development')
    puts "Database created!"
  end

  desc "Run migrations"
  task :migrate do
    ActiveRecord::Base.establish_connection(ENV['DATABASE_URL'] || 'postgresql://localhost/listing_aggregator_development')
    ActiveRecord::Migration.verbose = true
    ActiveRecord::Migration.migrate("db/migrate/")
    puts "Migrations completed!"
  end

  desc "Seed the database with sample data"
  task :seed do
    require_relative 'db/seeds/sample_data'
    puts "Database seeded!"
  end

  desc "Reset database (drop, create, migrate, seed)"
  task :reset => [:drop, :create, :migrate, :seed] do
    puts "Database reset complete!"
  end
end 